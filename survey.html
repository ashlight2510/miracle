<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <title>MIRACLE | ì„¤ë¬¸</title>
    <style>
      :root {
        --bg: #0b1220;
        --card: #0f1a2e;
        --text: #e9eef7;
        --muted: #9fb0c8;
        --line: #1c2a45;
        --accent: #8be9fd;
        --gold: #ffd166;
        --good: #a7f3d0;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
        background: radial-gradient(
            1200px 800px at 70% 10%,
            rgba(139, 233, 253, 0.08),
            transparent 60%
          ),
          radial-gradient(
            900px 600px at 20% 0%,
            rgba(255, 209, 102, 0.08),
            transparent 55%
          ),
          var(--bg);
        color: var(--text);
        line-height: 1.5;
      }
      .wrap {
        max-width: 680px;
        margin: 0 auto;
        padding: 28px 18px 60px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 14px;
        margin-bottom: 24px;
      }
      .brand {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .logo {
        font-weight: 900;
        letter-spacing: 0.7px;
        font-size: 18px;
        color: var(--accent);
      }
      .subtitle {
        color: var(--muted);
        font-size: 14px;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 28px;
        margin-bottom: 20px;
      }
      .h1 {
        font-size: 22px;
        font-weight: 1000;
        margin: 0 0 12px;
        letter-spacing: -0.2px;
      }
      .lead {
        color: var(--muted);
        margin: 0 0 24px;
      }
      .step {
        display: none;
      }
      .step.active {
        display: block;
      }
      .stepNumber {
        color: var(--accent);
        font-size: 14px;
        font-weight: 800;
        margin-bottom: 8px;
      }
      .questionTitle {
        font-weight: 800;
        font-size: 18px;
        margin-bottom: 12px;
        color: var(--text);
      }
      .questionDesc {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 20px;
        line-height: 1.6;
      }
      .options {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }
      .option {
        cursor: pointer;
        border: 2px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        background: rgba(0, 0, 0, 0.14);
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 16px;
        font-weight: 600;
      }
      .option:hover {
        border-color: rgba(139, 233, 253, 0.4);
        background: rgba(139, 233, 253, 0.06);
      }
      .option.selected {
        border-color: rgba(139, 233, 253, 0.6);
        background: rgba(139, 233, 253, 0.12);
      }
      .checkboxGroup {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }
      .checkbox {
        cursor: pointer;
        border: 2px solid var(--line);
        border-radius: 12px;
        padding: 14px;
        background: rgba(0, 0, 0, 0.14);
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .checkbox:hover {
        border-color: rgba(139, 233, 253, 0.4);
        background: rgba(139, 233, 253, 0.06);
      }
      .checkbox input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }
      .checkbox input[type="checkbox"]:checked + label {
        color: var(--accent);
      }
      .checkbox label {
        cursor: pointer;
        flex: 1;
        font-size: 15px;
      }
      .resultBox {
        border-left: 3px solid rgba(139, 233, 253, 0.35);
        padding: 16px 18px;
        background: rgba(139, 233, 253, 0.06);
        border-radius: 12px;
        margin: 20px 0;
        font-size: 16px;
        line-height: 1.6;
      }
      .resultBox.gold {
        border-left-color: rgba(255, 209, 102, 0.45);
        background: rgba(255, 209, 102, 0.08);
      }
      .resultBox .highlight {
        font-size: 20px;
        font-weight: 1000;
        color: var(--gold);
        margin: 8px 0;
      }
      .btn {
        cursor: pointer;
        border: 1px solid var(--line);
        background: rgba(139, 233, 253, 0.12);
        border-color: rgba(139, 233, 253, 0.4);
        color: var(--text);
        padding: 14px 28px;
        border-radius: 12px;
        font-weight: 800;
        transition: 0.15s transform ease, 0.15s background ease,
          0.15s border ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        width: 100%;
        justify-content: center;
        margin-top: 8px;
      }
      .btn:hover {
        transform: translateY(-2px);
        border-color: rgba(139, 233, 253, 0.6);
        background: rgba(139, 233, 253, 0.18);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .summary {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        padding: 16px;
        margin: 20px 0;
      }
      .summaryItem {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 14px;
      }
      .summaryItem:last-child {
        margin-bottom: 0;
      }
      .progress {
        height: 4px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 999px;
        margin-bottom: 24px;
        overflow: hidden;
      }
      .progressFill {
        height: 100%;
        background: rgba(139, 233, 253, 0.55);
        transition: width 0.3s ease;
      }
      .fine {
        color: var(--muted);
        font-size: 12px;
        margin-top: 12px;
        line-height: 1.5;
      }
      .pause {
        margin: 20px 0;
        text-align: center;
        color: var(--muted);
        font-size: 14px;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo">MIRACLE</div>
          <div class="subtitle">ì„¤ë¬¸ ì§„í–‰ ì¤‘</div>
        </div>
        <a
          href="index.html"
          style="color: var(--muted); text-decoration: none; font-size: 14px"
          >â† ëŒì•„ê°€ê¸°</a
        >
      </header>

      <div class="progress">
        <div class="progressFill" id="progressFill" style="width: 20%"></div>
      </div>

      <!-- STEP 1: ì§€ì—­ ì„ íƒ -->
      <div class="card step active" id="step1">
        <div class="stepNumber">STEP 1</div>
        <div class="questionTitle">ë‹¹ì‹ ì´ íƒœì–´ë‚œ ì§€ì—­ì€?</div>

        <div class="options">
          <div
            class="option"
            data-value="kr"
            onclick="selectOption(this, 'region', 'kr')"
          >
            ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­
          </div>
          <div
            class="option"
            data-value="other"
            onclick="selectOption(this, 'region', 'other')"
          >
            ğŸŒ ê¸°íƒ€ êµ­ê°€
          </div>
        </div>

        <div class="resultBox" id="result1" style="display: none">
          ì „ ì„¸ê³„ ê¸°ì¤€,<br />
          ë‹¹ì‹ ì´ ì´ ì§€ì—­ì—ì„œ íƒœì–´ë‚  í™•ë¥ ì€<br />
          ì•½ <span class="highlight" id="prob1">0.6%</span> ì…ë‹ˆë‹¤.<br />
          <div class="fine" id="result1Reason" style="margin-top: 10px"></div>
        </div>

        <button class="btn" id="btn1" onclick="nextStep(2)" disabled>
          ë‹¤ìŒ ë‹¨ê³„ â†’
        </button>
      </div>

      <!-- STEP 2: ì„ ì§„êµ­ ì¡°ê±´ -->
      <div class="card step" id="step2">
        <div class="stepNumber">STEP 2</div>
        <div class="questionTitle">
          ë‹¹ì‹ ì´ íƒœì–´ë‚œ ë‚˜ë¼ëŠ” ì–´ë–¤ í™˜ê²½ì— ê°€ê¹Œì› ë‚˜ìš”?
        </div>

        <div class="checkboxGroup">
          <div class="checkbox">
            <input type="checkbox" id="check1" onchange="updateCheckboxes()" />
            <label for="check1">ì•ˆì •ì ì¸ ì‚¬íšŒ</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="check2" onchange="updateCheckboxes()" />
            <label for="check2">êµìœ¡ ì ‘ê·¼ ê°€ëŠ¥</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="check3" onchange="updateCheckboxes()" />
            <label for="check3">ì˜ë£Œ ì‹œìŠ¤í…œ ì´ìš© ê°€ëŠ¥</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="check4" onchange="updateCheckboxes()" />
            <label for="check4">ì „ìŸÂ·ê¸°ê·¼ ì—†ìŒ</label>
          </div>
        </div>

        <div class="resultBox gold" id="result2" style="display: none">
          ì „ ì„¸ê³„ ì¶œìƒ ì¤‘<br />
          ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë¹„ìœ¨ì€<br />
          ì•½ <span class="highlight" id="prob2">17%</span> ì…ë‹ˆë‹¤.<br />
          <div class="fine" style="margin-top: 10px">
            ê·¼ê±°: ì•ˆì •Â·êµìœ¡Â·ì˜ë£ŒÂ·ë¹„ì „ìŸì„ <b>ë™ì‹œì—</b> ë§Œì¡±í•˜ëŠ” í™˜ê²½ì˜
            <b>êµì§‘í•©</b>ì„ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡ì€ ê°’ (ì•½ 15~20% êµ¬ê°„)
          </div>
        </div>

        <button class="btn" id="btn2" onclick="confirmStep2()" disabled>
          ì„ íƒ ì™„ë£Œ
        </button>
      </div>

      <!-- STEP 3: ì§€ì—­ ì œì™¸ í™•ë¥  -->
      <div class="card step" id="step3">
        <div class="stepNumber">STEP 3</div>
        <div class="questionTitle">
          ë§Œì•½ ë‹¤ì‹œ íƒœì–´ë‚œë‹¤ë©´, ì•„ë˜ ì¡°ê±´ ì¤‘ í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½ì„ ì§ì ‘ ê³¨ë¼ë³´ì„¸ìš”.
        </div>

        <div class="checkboxGroup">
          <div class="checkbox">
            <input type="checkbox" id="exChina" onchange="updateExclusions()" />
            <label for="exChina">ì¤‘êµ­</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="exIndia" onchange="updateExclusions()" />
            <label for="exIndia">ì¸ë„</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="exAfrica" onchange="updateExclusions()" />
            <label for="exAfrica">ì•„í”„ë¦¬ì¹´ ì§€ì—­</label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exConflict"
              onchange="updateExclusions()"
            />
            <label for="exConflict">ë¶„ìŸÂ·ë‚´ì „ ìœ„í—˜ì´ ìˆëŠ” í™˜ê²½</label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exLowEdu"
              onchange="updateExclusions()"
            />
            <label for="exLowEdu">ê¸°ë³¸ êµìœ¡ ì ‘ê·¼ì´ ì–´ë ¤ìš´ í™˜ê²½</label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exLowHealth"
              onchange="updateExclusions()"
            />
            <label for="exLowHealth">ì•„í”Œ ë•Œ ì œëŒ€ë¡œ ì¹˜ë£Œë°›ê¸° ì–´ë ¤ìš´ í™˜ê²½</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="exUnsafe" onchange="updateExclusions()" />
            <label for="exUnsafe">ì¼ìƒì  ì•ˆì „(ì¹˜ì•ˆ)ì´ ë¶ˆì•ˆí•œ í™˜ê²½</label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exExtremePoverty"
              onchange="updateExclusions()"
            />
            <label for="exExtremePoverty">ê·¹ì €ì†Œë“ êµ­ê°€ êµ¬ê°„</label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exWater"
              onchange="updateExclusions()"
            />
            <label for="exWater">ê¹¨ë—í•œ ì‹ìˆ˜Â·ìœ„ìƒ ì¸í”„ë¼ ì·¨ì•½</label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exCorruption"
              onchange="updateExclusions()"
            />
            <label for="exCorruption">ì‹¬ê°í•œ ë¶€íŒ¨Â·ë²•ì¹˜ ì·¨ì•½</label>
          </div>
        </div>

        <div class="resultBox" id="result3" style="display: none">
          í˜„ì¬ ë‚¨ëŠ” í™•ë¥ <br />
          <span class="highlight" id="regionProb">100.0%</span>
          <div class="fine" id="regionMsg" style="margin-top: 8px">
            ì•„ì§ ì—¬ìœ  ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>

        <button class="btn" id="btn3" onclick="nextStep(4)">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
      </div>

      <!-- STEP 4: ëˆ„ì  ê³„ì‚° ì‹œì‘ -->
      <div class="card step" id="step4">
        <div class="stepNumber">STEP 4</div>
        <div class="questionTitle">ì§€ê¸ˆê¹Œì§€ ì„ íƒí•œ ì¡°ê±´ì„ í•œ ì¤„ë¡œ ì •ë¦¬</div>

        <div class="summary" id="summary">
          <div class="summaryItem">
            âœ” <span id="summaryRegion">íŠ¹ì • ì§€ì—­ì—ì„œ</span>
          </div>
          <div class="summaryItem">
            âœ” <span id="summaryCondition">ë¹„êµì  ì•ˆì •ì ì¸ í™˜ê²½ì—ì„œ</span>
          </div>
          <div class="summaryItem">
            âœ” <span id="summaryExclusions">í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½ ì„ íƒ ì—†ìŒ</span>
          </div>
          <div class="summaryItem">
            âœ” <span id="summaryRemaining">ì œì™¸í•˜ê³  ì‹¶ì€ í™˜ê²½ ë¹„ì¤‘ 0.0%</span>
          </div>
          <div class="summaryItem">âœ” íƒœì–´ë‚¬ìŠµë‹ˆë‹¤</div>
        </div>

        <div class="resultBox">
          ì´ì œ,<br />
          ê°€ì¥ ê¸°ë³¸ì ì¸ í™•ë¥ ì„ ë”í•´ë³¼ê²Œìš”.<br />
        </div>

        <button class="btn" id="btn4" onclick="nextStep(5)">
          ìµœì¢… ê²°ê³¼ ë³´ê¸° â†’
        </button>
      </div>

      <!-- STEP 5: ë§ˆì§€ë§‰ ê³µê°œ -->
      <div class="card step" id="step5">
        <div class="stepNumber">STEP 5</div>
        <div class="questionTitle">ğŸ¯ ìµœì¢… ê²°ê³¼</div>

        <div class="resultBox">
          ì°¸ê³ ë¡œ,<br />
          ì‚¬ëŒì´ íƒœì–´ë‚  ë•Œ<br />
          ì •ìëŠ” í‰ê· <br />
          ì•½ <span class="highlight">3ì–µ ê°œ</span> ì¤‘ í•˜ë‚˜ê°€<br />
          ì„ íƒë©ë‹ˆë‹¤.
        </div>

        <div class="pause">ì ê¹ ë©ˆì¶¤ (ìŠ¤í¬ë¡¤ or í´ë¦­)</div>

        <div class="resultBox gold" id="finalResult">
          ì§€ê¸ˆê¹Œì§€ì˜ ì¡°ê±´ì„ ëª¨ë‘ í•©ì¹˜ë©´<br />
          <div
            class="highlight"
            style="font-size: 24px; margin: 12px 0"
            id="finalProb"
          >
            ê³„ì‚° ì¤‘...
          </div>
          <div class="fine" id="finalProbNoSperm"></div>
        </div>

        <button class="btn" id="btn5" onclick="goToResult()">
          ğŸ“Š ìƒì„¸ ê²°ê³¼ ë³´ê¸°
        </button>
      </div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);
      let currentStep = 1;
      let surveyData = {
        region: null,
        conditions: [],
        exclusions: [],
        regionRemaining: 1,
        finalProbability: null,
      };
      let step2Confirmed = false;

      // STEP 1: ì§€ì—­ ì„ íƒ
      function selectOption(element, type, value) {
        // ê°™ì€ íƒ€ì…ì˜ ë‹¤ë¥¸ ì˜µì…˜ ì„ íƒ í•´ì œ
        const options = element.parentElement.querySelectorAll(".option");
        options.forEach((opt) => opt.classList.remove("selected"));
        element.classList.add("selected");

        surveyData[type] = value;

        // ê²°ê³¼ í‘œì‹œ
        const resultBox = $("result1");
        const probElement = $("prob1");
        const reasonElement = $("result1Reason");

        if (value === "kr") {
          // ëŒ€í•œë¯¼êµ­: ì•½ 0.6% (ì „ ì„¸ê³„ ì¸êµ¬ ê¸°ì¤€)
          probElement.textContent = "0.6%";
          reasonElement.innerHTML =
            "ê·¼ê±°: ì „ ì„¸ê³„ ì¸êµ¬ 80~81ì–µ, ëŒ€í•œë¯¼êµ­ ì¸êµ¬ 5,100ë§Œ<br />" +
            "51,000,000 Ã· 8,100,000,000 â‰ˆ 0.0063 â†’ ì•½ 0.63%";
          resultBox.style.display = "block";
        } else {
          // ê¸°íƒ€ êµ­ê°€: ê²°ê³¼ ë°•ìŠ¤ í‘œì‹œ ì•ˆ í•¨
          resultBox.style.display = "none";
        }

        $("btn1").disabled = false;
        updateProgress(1);
      }

      // STEP 2: ì²´í¬ë°•ìŠ¤ ì—…ë°ì´íŠ¸
      function updateCheckboxes() {
        const checks = [
          $("check1").checked,
          $("check2").checked,
          $("check3").checked,
          $("check4").checked,
        ];

        const checkedCount = checks.filter((c) => c).length;
        surveyData.conditions = checks;

        if (checkedCount >= 1) {
          $("btn2").disabled = false;
          updateProgress(2);
          if (step2Confirmed) {
            updateStep2Result(checkedCount);
          }
        } else {
          $("result2").style.display = "none";
          $("btn2").disabled = true;
          step2Confirmed = false;
          $("btn2").textContent = "ì„ íƒ ì™„ë£Œ";
        }
      }

      function confirmStep2() {
        const checkedCount = surveyData.conditions.filter((c) => c).length;
        if (!step2Confirmed) {
          if (checkedCount < 1) {
            return;
          }
          updateStep2Result(checkedCount);
          $("result2").style.display = "block";
          step2Confirmed = true;
          $("btn2").textContent = "ë‹¤ìŒ ë‹¨ê³„ â†’";
          return;
        }
        nextStep(3);
      }

      function updateStep2Result(count) {
        const percentMap = {
          1: "45%",
          2: "30%",
          3: "17%",
          4: "8~9%",
        };
        $("prob2").textContent = percentMap[count] || "â€”";
      }

      function updateExclusions() {
        const rates = {
          exChina: 0.18,
          exIndia: 0.18,
          exAfrica: 0.18,
          exConflict: 0.12,
          exLowEdu: 0.2,
          exLowHealth: 0.22,
          exUnsafe: 0.18,
          exExtremePoverty: 0.25,
          exWater: 0.15,
          exCorruption: 0.15,
        };
        const keys = Object.keys(rates);
        const selectedKeys = keys.filter((key) => $(key).checked);
        surveyData.exclusions = selectedKeys;

        let remaining = 1;
        selectedKeys.forEach((key) => {
          remaining *= 1 - rates[key];
        });

        const remainingPercent = Math.round(remaining * 1000) / 10;
        $("regionProb").textContent = `${remainingPercent.toFixed(1)}%`;
        surveyData.regionRemaining = remaining;

        let msg = "ì•„ì§ ì—¬ìœ  ìˆìŒ ğŸ˜";
        if (remaining <= 0.1) {
          msg = "ì´ì œëŠ” â€˜ì„ íƒâ€™ì´ ì•„ë‹ˆë¼ â€˜ì†Œì›â€™ ìˆ˜ì¤€";
        } else if (remaining <= 0.2) {
          msg = "ì´ ì •ë„ë©´ ë‹¤ì‹œ íƒœì–´ë‚˜ê¸° ë¹¡ì…ˆ";
        } else if (remaining < 0.4) {
          msg = "ìƒê°ë³´ë‹¤ ë¹¨ë¦¬ ì¤„ì£ ?";
        }
        $("regionMsg").textContent = msg;
        $("result3").style.display = "block";
        updateProgress(3);
      }

      // STEP 4: ìš”ì•½ ì—…ë°ì´íŠ¸
      function showStep4() {
        const regionText =
          surveyData.region === "kr" ? "ëŒ€í•œë¯¼êµ­ì—ì„œ" : "íŠ¹ì • ì§€ì—­ì—ì„œ";
        $("summaryRegion").textContent = regionText;

        const conditionCount = surveyData.conditions.filter((c) => c).length;
        const conditionText =
          conditionCount >= 3
            ? "ë¹„êµì  ì•ˆì •ì ì¸ í™˜ê²½ì—ì„œ"
            : "ì¼ë¶€ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í™˜ê²½ì—ì„œ";
        $("summaryCondition").textContent = conditionText;

        const exclusionLabels = {
          exChina: "ì¤‘êµ­",
          exIndia: "ì¸ë„",
          exAfrica: "ì•„í”„ë¦¬ì¹´ ì§€ì—­",
          exConflict: "ë¶„ìŸÂ·ë‚´ì „ ìœ„í—˜ í™˜ê²½",
          exLowEdu: "êµìœ¡ ì ‘ê·¼ ì–´ë ¤ì›€",
          exLowHealth: "ì˜ë£Œ ì ‘ê·¼ ì–´ë ¤ì›€",
          exUnsafe: "ì¹˜ì•ˆ ë¶ˆì•ˆ",
          exExtremePoverty: "ê·¹ì €ì†Œë“ êµ­ê°€",
          exWater: "ì‹ìˆ˜Â·ìœ„ìƒ ì·¨ì•½",
          exCorruption: "ë¶€íŒ¨Â·ë²•ì¹˜ ì·¨ì•½",
        };
        const selected = surveyData.exclusions || [];
        const exclusionText =
          selected.length > 0
            ? `í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½: ${selected
                .map((key) => exclusionLabels[key] || key)
                .join(", ")}`
            : "í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½ ì„ íƒ ì—†ìŒ";
        $("summaryExclusions").textContent = exclusionText;

        const remaining = surveyData.regionRemaining ?? 1;
        const excludedPercent = ((1 - remaining) * 100).toFixed(1);
        $("summaryRemaining").textContent = `ì œì™¸í•˜ê³  ì‹¶ì€ í™˜ê²½ ë¹„ì¤‘ ${excludedPercent}%`;

        updateProgress(4);
      }

      // STEP 5: ìµœì¢… í™•ë¥  ê³„ì‚°
      function calculateFinal() {
        // ê°„ë‹¨í•œ ê³„ì‚° ì˜ˆì‹œ:
        // STEP 1: 0.6% (ëŒ€í•œë¯¼êµ­) ë˜ëŠ” 1-2% (ê¸°íƒ€)
        // STEP 2: ì¡°ê±´ ê°œìˆ˜ ê¸°ë°˜ í™•ë¥ 
        // STEP 3: ì œì™¸ ì˜µì…˜ ê¸°ë°˜ ë‚¨ëŠ” í™•ë¥ 
        // STEP 5: ì •ì í™•ë¥  í¬í•¨/ì œì™¸ ëª¨ë‘ ê³„ì‚°

        let baseProb = surveyData.region === "kr" ? 0.006 : 0.015;
        const conditionCount = surveyData.conditions.filter((c) => c).length;
        const conditionProbMap = {
          1: 0.45,
          2: 0.3,
          3: 0.17,
          4: 0.085,
        };
        let conditionProb = conditionProbMap[conditionCount] || 1;
        let regionProb = surveyData.regionRemaining || 1;
        let spermProb = 1 / 300000000;

        // ëˆ„ì  í™•ë¥  ê³„ì‚° (ë‹¨ìˆœí™”ëœ ë²„ì „)
        let cumulative = baseProb * conditionProb * regionProb * spermProb;
        let cumulativeNoSperm = baseProb * conditionProb * regionProb;

        // ë” ì½ê¸° ì‰½ê²Œ í‘œí˜„
        const finalPercent = (cumulative * 100).toFixed(10);
        const finalRatio = Math.round(1 / cumulative).toLocaleString();
        const finalPercentNoSperm = (cumulativeNoSperm * 100).toFixed(4);
        const finalRatioNoSperm = Math.round(1 / cumulativeNoSperm).toLocaleString();

        surveyData.finalProbability = {
          percent: finalPercent,
          ratio: finalRatio,
        };

        $(
          "finalProb"
        ).innerHTML = `ì•½ ${finalRatio}ë¶„ì˜ 1<br /><span style="font-size: 16px;">(${finalPercent}%)</span>`;
        $(
          "finalProbNoSperm"
        ).innerHTML = `ì •ì í™•ë¥  ì œì™¸: ì•½ ${finalRatioNoSperm}ë¶„ì˜ 1 (${finalPercentNoSperm}%)`;
        updateProgress(5);
      }

      function nextStep(step) {
        // í˜„ì¬ ë‹¨ê³„ ìˆ¨ê¸°ê¸°
        $(`step${currentStep}`).classList.remove("active");

        // ë‹¤ìŒ ë‹¨ê³„ ë³´ì´ê¸°
        currentStep = step;
        $(`step${step}`).classList.add("active");

        // ê° ë‹¨ê³„ë³„ íŠ¹ë³„ ì²˜ë¦¬
        if (step === 3) {
          setTimeout(updateExclusions, 0);
        } else if (step === 4) {
          showStep4();
        } else if (step === 5) {
          setTimeout(calculateFinal, 500);
        }

        // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function updateProgress(step) {
        const progress = (step / 5) * 100;
        $("progressFill").style.width = progress + "%";
      }

      function goToResult() {
        // ì„¤ë¬¸ ë°ì´í„°ë¥¼ URL íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
        const params = new URLSearchParams({
          region: surveyData.region || "kr",
          conditions: surveyData.conditions
            .map((c) => (c ? "1" : "0"))
            .join(""),
          exclusions: (surveyData.exclusions || []).join(","),
          remaining: (surveyData.regionRemaining ?? 1).toFixed(4),
          final: surveyData.finalProbability?.ratio || "0",
        });
        window.location.href = `result.html?${params.toString()}`;
      }

      // ì´ˆê¸°í™”
      updateProgress(1);
    </script>
  </body>
</html>
