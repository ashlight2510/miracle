<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <title>MIRACLE | ì„¤ë¬¸</title>
    <style>
      :root {
        --bg: #0b1220;
        --card: #0f1a2e;
        --text: #e9eef7;
        --muted: #9fb0c8;
        --line: #1c2a45;
        --accent: #8be9fd;
        --gold: #ffd166;
        --good: #a7f3d0;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
        background: radial-gradient(
            1200px 800px at 70% 10%,
            rgba(139, 233, 253, 0.08),
            transparent 60%
          ),
          radial-gradient(
            900px 600px at 20% 0%,
            rgba(255, 209, 102, 0.08),
            transparent 55%
          ),
          var(--bg);
        color: var(--text);
        line-height: 1.5;
      }
      .wrap {
        max-width: 680px;
        margin: 16px auto;
        padding: 28px 18px 60px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 14px;
        margin-bottom: 24px;
      }
      .brand {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .logo {
        font-weight: 900;
        letter-spacing: 0.7px;
        font-size: 18px;
        color: var(--accent);
      }
      .subtitle {
        color: var(--muted);
        font-size: 14px;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 28px;
        margin-bottom: 20px;
      }
      .h1 {
        font-size: 22px;
        font-weight: 1000;
        margin: 0 0 12px;
        letter-spacing: -0.2px;
      }
      .lead {
        color: var(--muted);
        margin: 0 0 24px;
      }
      .step {
        display: none;
      }
      .step.active {
        display: block;
      }
      .stepNumber {
        color: var(--accent);
        font-size: 14px;
        font-weight: 800;
        margin-bottom: 8px;
      }
      .questionTitle {
        font-weight: 800;
        font-size: 18px;
        margin-bottom: 12px;
        color: var(--text);
      }
      .questionDesc {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 20px;
        line-height: 1.6;
      }
      .options {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }
      .option {
        cursor: pointer;
        border: 2px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        background: rgba(0, 0, 0, 0.14);
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 16px;
        font-weight: 600;
      }
      .option:hover {
        border-color: rgba(139, 233, 253, 0.4);
        background: rgba(139, 233, 253, 0.06);
      }
      .option.selected {
        border-color: rgba(139, 233, 253, 0.6);
        background: rgba(139, 233, 253, 0.12);
      }
      .checkboxGroup {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }
      .checkbox {
        cursor: pointer;
        border: 2px solid var(--line);
        border-radius: 12px;
        padding: 14px;
        background: rgba(0, 0, 0, 0.14);
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .checkbox:hover {
        border-color: rgba(139, 233, 253, 0.4);
        background: rgba(139, 233, 253, 0.06);
      }
      .checkbox input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }
      .checkbox input[type="checkbox"]:checked + label {
        color: var(--accent);
      }
      .checkbox label {
        cursor: pointer;
        flex: 1;
        font-size: 15px;
      }
      .resultBox {
        border-left: 3px solid rgba(139, 233, 253, 0.35);
        padding: 16px 18px;
        background: rgba(139, 233, 253, 0.06);
        border-radius: 12px;
        margin: 20px 0;
        font-size: 16px;
        line-height: 1.6;
      }
      .resultBox.gold {
        border-left-color: rgba(255, 209, 102, 0.45);
        background: rgba(255, 209, 102, 0.08);
      }
      .resultBox .highlight {
        font-size: 20px;
        font-weight: 1000;
        color: var(--gold);
        margin: 8px 0;
      }
      .btn {
        cursor: pointer;
        border: 1px solid var(--line);
        background: rgba(139, 233, 253, 0.12);
        border-color: rgba(139, 233, 253, 0.4);
        color: var(--text);
        padding: 14px 28px;
        border-radius: 12px;
        font-weight: 800;
        transition: 0.15s transform ease, 0.15s background ease,
          0.15s border ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        width: 100%;
        justify-content: center;
        margin-top: 8px;
      }
      .btn:hover {
        transform: translateY(-2px);
        border-color: rgba(139, 233, 253, 0.6);
        background: rgba(139, 233, 253, 0.18);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .summary {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        padding: 16px;
        margin: 20px 0;
      }
      .summaryItem {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 14px;
      }
      .summaryItem:last-child {
        margin-bottom: 0;
      }
      .progress {
        height: 4px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 999px;
        margin-bottom: 24px;
        overflow: hidden;
      }
      .progressFill {
        height: 100%;
        background: rgba(139, 233, 253, 0.55);
        transition: width 0.3s ease;
      }
      .fine {
        color: var(--muted);
        font-size: 12px;
        margin-top: 12px;
        line-height: 1.5;
      }
      .pause {
        margin: 20px 0;
        text-align: center;
        color: var(--muted);
        font-size: 14px;
      }
      .lang-switch {
        position: fixed;
        top: 16px;
        right: 16px;
        display: inline-flex;
        gap: 0;
        padding: 3px;
        border-radius: 999px;
        background: rgba(11, 18, 32, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        z-index: 100;
        border: 1px solid rgba(139, 233, 253, 0.3);
      }
      .lang-switch button {
        border: none;
        background: transparent;
        color: rgba(255, 255, 255, 0.7);
        font-size: 12px;
        font-weight: 700;
        padding: 7px 14px;
        border-radius: 999px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-width: 44px;
        text-align: center;
        letter-spacing: 0.02em;
      }
      .lang-switch button.active {
        background: rgba(139, 233, 253, 0.2);
        color: #8be9fd;
        box-shadow: 0 2px 8px rgba(139, 233, 253, 0.4);
      }
      .lang-switch button:not(.active):hover {
        background: rgba(139, 233, 253, 0.1);
        color: rgba(255, 255, 255, 0.9);
      }
    </style>
  </head>

  <body>
    <div class="lang-switch" role="tablist" aria-label="Language switcher">
      <button type="button" data-lang="ko" class="active">KR</button>
      <button type="button" data-lang="en">EN</button>
    </div>
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo">MIRACLE</div>
          <div class="subtitle" data-i18n="survey.subtitle">ì„¤ë¬¸ ì§„í–‰ ì¤‘</div>
        </div>
        <a
          href="index.html"
          style="color: var(--muted); text-decoration: none; font-size: 14px"
          >â† ëŒì•„ê°€ê¸°</a
        >
      </header>

      <div class="progress">
        <div class="progressFill" id="progressFill" style="width: 20%"></div>
      </div>

      <!-- STEP 1: ì§€ì—­ ì„ íƒ -->
      <div class="card step active" id="step1">
        <div class="stepNumber">STEP 1</div>
        <div class="questionTitle" data-i18n="steps.step1Title">
          ë‹¹ì‹ ì´ íƒœì–´ë‚œ ì§€ì—­ì€?
        </div>

        <div class="options">
          <div
            class="option"
            data-value="kr"
            onclick="selectOption(this, 'region', 'kr')"
          >
            <span data-i18n="options.regionKR">ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­</span>
          </div>
          <div
            class="option"
            data-value="other"
            onclick="selectOption(this, 'region', 'other')"
          >
            <span data-i18n="options.regionOther">ğŸŒ ê¸°íƒ€ êµ­ê°€</span>
          </div>
        </div>

        <div class="resultBox" id="result1" style="display: none">
          <div data-i18n="result1.line1">ì „ ì„¸ê³„ ê¸°ì¤€,</div>
          <div data-i18n="result1.line2">ë‹¹ì‹ ì´ ì´ ì§€ì—­ì—ì„œ íƒœì–´ë‚  í™•ë¥ ì€</div>
          <div>
            <span data-i18n="result1.prefix">ì•½ </span>
            <span class="highlight" id="prob1">0.6%</span>
            <span data-i18n="result1.suffix"> ì…ë‹ˆë‹¤.</span>
          </div>
          <div class="fine" id="result1Reason" style="margin-top: 10px"></div>
        </div>

        <button
          class="btn"
          id="btn1"
          data-i18n="btn.step1.next"
          onclick="nextStep(2)"
          disabled
        >
          ë‹¤ìŒ ë‹¨ê³„ â†’
        </button>
      </div>

      <!-- STEP 2: ì„ ì§„êµ­ ì¡°ê±´ -->
      <div class="card step" id="step2">
        <div class="stepNumber">STEP 2</div>
        <div class="questionTitle" data-i18n="steps.step2Title">
          ë‹¹ì‹ ì´ íƒœì–´ë‚œ ë‚˜ë¼ëŠ” ì–´ë–¤ í™˜ê²½ì— ê°€ê¹Œì› ë‚˜ìš”?
        </div>

        <div class="checkboxGroup">
          <div class="checkbox">
            <input type="checkbox" id="check1" onchange="updateCheckboxes()" />
            <label for="check1" data-i18n="conditions.check1">
              ì•ˆì •ì ì¸ ì‚¬íšŒ
            </label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="check2" onchange="updateCheckboxes()" />
            <label for="check2" data-i18n="conditions.check2">
              êµìœ¡ ì ‘ê·¼ ê°€ëŠ¥
            </label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="check3" onchange="updateCheckboxes()" />
            <label for="check3" data-i18n="conditions.check3">
              ì˜ë£Œ ì‹œìŠ¤í…œ ì´ìš© ê°€ëŠ¥
            </label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="check4" onchange="updateCheckboxes()" />
            <label for="check4" data-i18n="conditions.check4">
              ì „ìŸÂ·ê¸°ê·¼ ì—†ìŒ
            </label>
          </div>
        </div>

        <div class="resultBox gold" id="result2" style="display: none">
          <div data-i18n="result2.line1">ì „ ì„¸ê³„ ì¶œìƒ ì¤‘</div>
          <div data-i18n="result2.line2">ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë¹„ìœ¨ì€</div>
          <div>
            <span data-i18n="result2.prefix">ì•½ </span>
            <span class="highlight" id="prob2">17%</span>
            <span data-i18n="result2.suffix"> ì…ë‹ˆë‹¤.</span>
          </div>
          <div class="fine" data-i18n-html="result2.reason" style="margin-top: 10px">
            ê·¼ê±°: ì•ˆì •Â·êµìœ¡Â·ì˜ë£ŒÂ·ë¹„ì „ìŸì„ <b>ë™ì‹œì—</b> ë§Œì¡±í•˜ëŠ” í™˜ê²½ì˜
            <b>êµì§‘í•©</b>ì„ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡ì€ ê°’ (ì•½ 15~20% êµ¬ê°„)
          </div>
        </div>

        <button
          class="btn"
          id="btn2"
          data-i18n="btn.step2.confirm"
          onclick="confirmStep2()"
          disabled
        >
          ì„ íƒ ì™„ë£Œ
        </button>
      </div>

      <!-- STEP 3: ì§€ì—­ ì œì™¸ í™•ë¥  -->
      <div class="card step" id="step3">
        <div class="stepNumber">STEP 3</div>
        <div class="questionTitle" data-i18n="steps.step3Title">
          ë§Œì•½ ë‹¤ì‹œ íƒœì–´ë‚œë‹¤ë©´, ì•„ë˜ ì¡°ê±´ ì¤‘ í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½ì„ ì§ì ‘ ê³¨ë¼ë³´ì„¸ìš”.
        </div>

        <div class="checkboxGroup">
          <div class="checkbox">
            <input type="checkbox" id="exChina" onchange="updateExclusions()" />
            <label for="exChina" data-i18n="exclusions.exChina">ì¤‘êµ­</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="exIndia" onchange="updateExclusions()" />
            <label for="exIndia" data-i18n="exclusions.exIndia">ì¸ë„</label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="exAfrica" onchange="updateExclusions()" />
            <label for="exAfrica" data-i18n="exclusions.exAfrica">
              ì•„í”„ë¦¬ì¹´ ì§€ì—­
            </label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exConflict"
              onchange="updateExclusions()"
            />
            <label for="exConflict" data-i18n="exclusions.exConflict">
              ë¶„ìŸÂ·ë‚´ì „ ìœ„í—˜ì´ ìˆëŠ” í™˜ê²½
            </label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exLowEdu"
              onchange="updateExclusions()"
            />
            <label for="exLowEdu" data-i18n="exclusions.exLowEdu">
              ê¸°ë³¸ êµìœ¡ ì ‘ê·¼ì´ ì–´ë ¤ìš´ í™˜ê²½
            </label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exLowHealth"
              onchange="updateExclusions()"
            />
            <label for="exLowHealth" data-i18n="exclusions.exLowHealth">
              ì•„í”Œ ë•Œ ì œëŒ€ë¡œ ì¹˜ë£Œë°›ê¸° ì–´ë ¤ìš´ í™˜ê²½
            </label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="exUnsafe" onchange="updateExclusions()" />
            <label for="exUnsafe" data-i18n="exclusions.exUnsafe">
              ì¼ìƒì  ì•ˆì „(ì¹˜ì•ˆ)ì´ ë¶ˆì•ˆí•œ í™˜ê²½
            </label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exExtremePoverty"
              onchange="updateExclusions()"
            />
            <label for="exExtremePoverty" data-i18n="exclusions.exExtremePoverty">
              ê·¹ì €ì†Œë“ êµ­ê°€ êµ¬ê°„
            </label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exWater"
              onchange="updateExclusions()"
            />
            <label for="exWater" data-i18n="exclusions.exWater">
              ê¹¨ë—í•œ ì‹ìˆ˜Â·ìœ„ìƒ ì¸í”„ë¼ ì·¨ì•½
            </label>
          </div>
          <div class="checkbox">
            <input
              type="checkbox"
              id="exCorruption"
              onchange="updateExclusions()"
            />
            <label for="exCorruption" data-i18n="exclusions.exCorruption">
              ì‹¬ê°í•œ ë¶€íŒ¨Â·ë²•ì¹˜ ì·¨ì•½
            </label>
          </div>
        </div>

        <div class="resultBox" id="result3" style="display: none">
          <div data-i18n="result3.line1">í˜„ì¬ ë‚¨ëŠ” í™•ë¥ </div>
          <span class="highlight" id="regionProb">100.0%</span>
          <div
            class="fine"
            id="regionMsg"
            data-i18n="result3.msg.default"
            style="margin-top: 8px"
          >
            ì•„ì§ ì—¬ìœ  ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>

        <button
          class="btn"
          id="btn3"
          data-i18n="btn.step3.next"
          onclick="nextStep(4)"
        >
          ë‹¤ìŒ ë‹¨ê³„ â†’
        </button>
      </div>

      <!-- STEP 4: ëˆ„ì  ê³„ì‚° ì‹œì‘ -->
      <div class="card step" id="step4">
        <div class="stepNumber">STEP 4</div>
        <div class="questionTitle" data-i18n="steps.step4Title">
          ì§€ê¸ˆê¹Œì§€ ì„ íƒí•œ ì¡°ê±´ì„ í•œ ì¤„ë¡œ ì •ë¦¬
        </div>

        <div class="summary" id="summary">
          <div class="summaryItem">
            âœ” <span id="summaryRegion">íŠ¹ì • ì§€ì—­ì—ì„œ</span>
          </div>
          <div class="summaryItem">
            âœ” <span id="summaryCondition">ë¹„êµì  ì•ˆì •ì ì¸ í™˜ê²½ì—ì„œ</span>
          </div>
          <div class="summaryItem">
            âœ” <span id="summaryExclusions">í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½ ì„ íƒ ì—†ìŒ</span>
          </div>
          <div class="summaryItem">
            âœ” <span id="summaryRemaining">ì œì™¸í•˜ê³  ì‹¶ì€ í™˜ê²½ ë¹„ì¤‘ 0.0%</span>
          </div>
          <div class="summaryItem" data-i18n="step4.summary.conclusion">
            âœ” íƒœì–´ë‚¬ìŠµë‹ˆë‹¤
          </div>
        </div>

        <div class="resultBox" data-i18n-html="step4.resultBox">
          ì´ì œ,<br />
          ê°€ì¥ ê¸°ë³¸ì ì¸ í™•ë¥ ì„ ë”í•´ë³¼ê²Œìš”.<br />
        </div>

        <button
          class="btn"
          id="btn4"
          data-i18n="btn.step4.next"
          onclick="nextStep(5)"
        >
          ìµœì¢… ê²°ê³¼ ë³´ê¸° â†’
        </button>
      </div>

      <!-- STEP 5: ë§ˆì§€ë§‰ ê³µê°œ -->
      <div class="card step" id="step5">
        <div class="stepNumber">STEP 5</div>
        <div class="questionTitle" data-i18n="steps.step5Title">ğŸ¯ ìµœì¢… ê²°ê³¼</div>

        <div class="resultBox" data-i18n-html="step5.tip">
          ì°¸ê³ ë¡œ,<br />
          ì‚¬ëŒì´ íƒœì–´ë‚  ë•Œ<br />
          ì •ìëŠ” í‰ê· <br />
          ì•½ <span class="highlight">3ì–µ ê°œ</span> ì¤‘ í•˜ë‚˜ê°€<br />
          ì„ íƒë©ë‹ˆë‹¤.
        </div>

        <div class="pause" data-i18n="step5.pause">
          ì ê¹ ë©ˆì¶¤ (ìŠ¤í¬ë¡¤ or í´ë¦­)
        </div>

        <div class="resultBox gold" id="finalResult">
          <div data-i18n-html="step5.finalIntro">
            ì§€ê¸ˆê¹Œì§€ì˜ ì¡°ê±´ì„ ëª¨ë‘ í•©ì¹˜ë©´<br />
          </div>
          <div
            class="highlight"
            style="font-size: 24px; margin: 12px 0"
            id="finalProb"
            data-i18n="step5.finalPending"
          >
            ê³„ì‚° ì¤‘...
          </div>
          <div class="fine" id="finalProbNoSperm"></div>
        </div>

        <button class="btn" id="btn5" data-i18n="btn.step5.details" onclick="goToResult()">
          ğŸ“Š ìƒì„¸ ê²°ê³¼ ë³´ê¸°
        </button>
      </div>
    </div>

    <script>
      const translations = {
        ko: {
          survey: {
            metaTitle: "MIRACLE | ì„¤ë¬¸",
            metaDescription:
              "í•œêµ­ë³´ë‹¤ ì¡°ê±´ ì§€ìˆ˜ê°€ ì¡°ê¸ˆ ë” ë†’ì€ ë‚˜ë¼ì—ì„œ íƒœì–´ë‚  í™•ë¥ ì„ ìˆ«ìë¡œ ì²´ê°í•´ë³´ëŠ” í˜ì´ì§€. êµ­ê°€ ìš°ì—´ íŒë‹¨ ì—†ì´, í™•ë¥  ë¶„í¬ë§Œ ë‹¤ë£¹ë‹ˆë‹¤.",
            subtitle: "ì„¤ë¬¸ ì§„í–‰ ì¤‘",
          },
          steps: {
            step1Title: "ë‹¹ì‹ ì´ íƒœì–´ë‚œ ì§€ì—­ì€?",
            step2Title: "ë‹¹ì‹ ì´ íƒœì–´ë‚œ ë‚˜ë¼ëŠ” ì–´ë–¤ í™˜ê²½ì— ê°€ê¹Œì› ë‚˜ìš”?",
            step3Title:
              "ë§Œì•½ ë‹¤ì‹œ íƒœì–´ë‚œë‹¤ë©´, ì•„ë˜ ì¡°ê±´ ì¤‘ í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½ì„ ì§ì ‘ ê³¨ë¼ë³´ì„¸ìš”.",
            step4Title: "ì§€ê¸ˆê¹Œì§€ ì„ íƒí•œ ì¡°ê±´ì„ í•œ ì¤„ë¡œ ì •ë¦¬",
            step5Title: "ğŸ¯ ìµœì¢… ê²°ê³¼",
          },
          options: {
            regionKR: "ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­",
            regionOther: "ğŸŒ ê¸°íƒ€ êµ­ê°€",
          },
          result1: {
            line1: "ì „ ì„¸ê³„ ê¸°ì¤€,",
            line2: "ë‹¹ì‹ ì´ ì´ ì§€ì—­ì—ì„œ íƒœì–´ë‚  í™•ë¥ ì€",
            prefix: "ì•½ ",
            suffix: " ì…ë‹ˆë‹¤.",
            reason:
              "ê·¼ê±°: ì „ ì„¸ê³„ ì¸êµ¬ 80~81ì–µ, ëŒ€í•œë¯¼êµ­ ì¸êµ¬ 5,100ë§Œ<br />51,000,000 Ã· 8,100,000,000 â‰ˆ 0.0063 â†’ ì•½ 0.63%",
          },
          conditions: {
            check1: "ì•ˆì •ì ì¸ ì‚¬íšŒ",
            check2: "êµìœ¡ ì ‘ê·¼ ê°€ëŠ¥",
            check3: "ì˜ë£Œ ì‹œìŠ¤í…œ ì´ìš© ê°€ëŠ¥",
            check4: "ì „ìŸÂ·ê¸°ê·¼ ì—†ìŒ",
          },
          result2: {
            line1: "ì „ ì„¸ê³„ ì¶œìƒ ì¤‘",
            line2: "ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë¹„ìœ¨ì€",
            prefix: "ì•½ ",
            suffix: " ì…ë‹ˆë‹¤.",
            reason:
              "ê·¼ê±°: ì•ˆì •Â·êµìœ¡Â·ì˜ë£ŒÂ·ë¹„ì „ìŸì„ <b>ë™ì‹œì—</b> ë§Œì¡±í•˜ëŠ” í™˜ê²½ì˜ <b>êµì§‘í•©</b>ì„ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡ì€ ê°’ (ì•½ 15~20% êµ¬ê°„)",
          },
          btn: {
            step1: { next: "ë‹¤ìŒ ë‹¨ê³„ â†’" },
            step2: { confirm: "ì„ íƒ ì™„ë£Œ", next: "ë‹¤ìŒ ë‹¨ê³„ â†’" },
            step3: { next: "ë‹¤ìŒ ë‹¨ê³„ â†’" },
            step4: { next: "ìµœì¢… ê²°ê³¼ ë³´ê¸° â†’" },
            step5: { details: "ğŸ“Š ìƒì„¸ ê²°ê³¼ ë³´ê¸°" },
          },
          exclusions: {
            exChina: "ì¤‘êµ­",
            exIndia: "ì¸ë„",
            exAfrica: "ì•„í”„ë¦¬ì¹´ ì§€ì—­",
            exConflict: "ë¶„ìŸÂ·ë‚´ì „ ìœ„í—˜ì´ ìˆëŠ” í™˜ê²½",
            exLowEdu: "ê¸°ë³¸ êµìœ¡ ì ‘ê·¼ì´ ì–´ë ¤ìš´ í™˜ê²½",
            exLowHealth: "ì•„í”Œ ë•Œ ì œëŒ€ë¡œ ì¹˜ë£Œë°›ê¸° ì–´ë ¤ìš´ í™˜ê²½",
            exUnsafe: "ì¼ìƒì  ì•ˆì „(ì¹˜ì•ˆ)ì´ ë¶ˆì•ˆí•œ í™˜ê²½",
            exExtremePoverty: "ê·¹ì €ì†Œë“ êµ­ê°€ êµ¬ê°„",
            exWater: "ê¹¨ë—í•œ ì‹ìˆ˜Â·ìœ„ìƒ ì¸í”„ë¼ ì·¨ì•½",
            exCorruption: "ì‹¬ê°í•œ ë¶€íŒ¨Â·ë²•ì¹˜ ì·¨ì•½",
          },
          result3: {
            line1: "í˜„ì¬ ë‚¨ëŠ” í™•ë¥ ",
            msg: {
              default: "ì•„ì§ ì—¬ìœ  ìˆìŒ ğŸ˜",
              low1: "ì´ì œëŠ” â€˜ì„ íƒâ€™ì´ ì•„ë‹ˆë¼ â€˜ì†Œì›â€™ ìˆ˜ì¤€",
              low2: "ì´ ì •ë„ë©´ ë‹¤ì‹œ íƒœì–´ë‚˜ê¸° ë¹¡ì…ˆ",
              low3: "ìƒê°ë³´ë‹¤ ë¹¨ë¦¬ ì¤„ì£ ?",
            },
          },
          step4: {
            resultBox: "ì´ì œ,<br />ê°€ì¥ ê¸°ë³¸ì ì¸ í™•ë¥ ì„ ë”í•´ë³¼ê²Œìš”.<br />",
            summary: {
              region: {
                kr: "ëŒ€í•œë¯¼êµ­ì—ì„œ",
                other: "íŠ¹ì • ì§€ì—­ì—ì„œ",
              },
              condition: {
                high: "ë¹„êµì  ì•ˆì •ì ì¸ í™˜ê²½ì—ì„œ",
                low: "ì¼ë¶€ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í™˜ê²½ì—ì„œ",
              },
              exclusion: {
                none: "í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½ ì„ íƒ ì—†ìŒ",
                prefix: "í”¼í•˜ê³  ì‹¶ì€ í™˜ê²½: ",
              },
              remaining: "ì œì™¸í•˜ê³  ì‹¶ì€ í™˜ê²½ ë¹„ì¤‘ {percent}%",
              conclusion: "âœ” íƒœì–´ë‚¬ìŠµë‹ˆë‹¤",
            },
          },
          step5: {
            tip:
              "ì°¸ê³ ë¡œ,<br />ì‚¬ëŒì´ íƒœì–´ë‚  ë•Œ<br />ì •ìëŠ” í‰ê· <br />ì•½ <span class=\"highlight\">3ì–µ ê°œ</span> ì¤‘ í•˜ë‚˜ê°€<br />ì„ íƒë©ë‹ˆë‹¤.",
            pause: "ì ê¹ ë©ˆì¶¤ (ìŠ¤í¬ë¡¤ or í´ë¦­)",
            finalIntro: "ì§€ê¸ˆê¹Œì§€ì˜ ì¡°ê±´ì„ ëª¨ë‘ í•©ì¹˜ë©´<br />",
            finalProbTemplate:
              "ì•½ {ratio}ë¶„ì˜ 1<br /><span style=\"font-size: 16px;\">({percent}%)</span>",
            finalProbNoSpermTemplate:
              "ì •ì í™•ë¥  ì œì™¸: ì•½ {ratio}ë¶„ì˜ 1 ({percent}%)",
            finalPending: "ê³„ì‚° ì¤‘...",
          },
        },
        en: {
          survey: {
            metaTitle: "MIRACLE | Survey",
            metaDescription:
              "A page to experience the probability of being born in a country with a slightly higher condition index than Korea. It only deals with probability distribution, without judging national superiority.",
            subtitle: "Survey in progress",
          },
          steps: {
            step1Title: "Where were you born?",
            step2Title:
              "Which environment best matches the country where you were born?",
            step3Title:
              "If you were reborn, which of the following environments would you avoid?",
            step4Title: "Summarize the choices you've made so far",
            step5Title: "ğŸ¯ Final result",
          },
          options: {
            regionKR: "ğŸ‡°ğŸ‡· South Korea",
            regionOther: "ğŸŒ Other countries",
          },
          result1: {
            line1: "On a global scale,",
            line2: "the probability of being born in this region is",
            prefix: "About ",
            suffix: ".",
            reason:
              "Basis: Global population ~8.1B vs South Korea ~51M<br />51,000,000 Ã· 8,100,000,000 â‰ˆ 0.0063 â†’ about 0.63%",
          },
          conditions: {
            check1: "Stable society",
            check2: "Access to education",
            check3: "Access to healthcare",
            check4: "No war or famine",
          },
          result2: {
            line1: "Among worldwide births",
            line2: "the share that meets these conditions is",
            prefix: "About ",
            suffix: ".",
            reason:
              "Basis: conservatively taking the <b>intersection</b> of stability, education, healthcare, and peace indicators (roughly 15â€“20%).",
          },
          btn: {
            step1: { next: "Next step â†’" },
            step2: { confirm: "Confirm selection", next: "Next step â†’" },
            step3: { next: "Next step â†’" },
            step4: { next: "View final result â†’" },
            step5: { details: "ğŸ“Š View detailed results" },
          },
          exclusions: {
            exChina: "China",
            exIndia: "India",
            exAfrica: "Africa region",
            exConflict: "Conflict or civil war risk",
            exLowEdu: "Limited education access",
            exLowHealth: "Limited healthcare access",
            exUnsafe: "Unsafe daily security",
            exExtremePoverty: "Extreme poverty countries",
            exWater: "Weak water & sanitation",
            exCorruption: "Severe corruption/legal weakness",
          },
          result3: {
            line1: "Current remaining probability",
            msg: {
              default: "Still plenty of room ğŸ˜",
              low1: "This is no longer a choice but a wish",
              low2: "At this point, being reborn is tough",
              low3: "It shrinks faster than you'd expect",
            },
          },
          step4: {
            resultBox: "Now,<br />let's add up the basic probabilities.<br />",
            summary: {
              region: {
                kr: "In South Korea",
                other: "In another region",
              },
              condition: {
                high: "In a relatively stable environment",
                low: "In an environment meeting some of the conditions",
              },
              exclusion: {
                none: "No avoided environments selected",
                prefix: "Avoided environments: ",
              },
              remaining: "Excluded environment share {percent}%",
              conclusion: "âœ” You've been born",
            },
          },
          step5: {
            tip:
              "FYI,<br />when a person is born,<br />one sperm out of an average<br />of <span class=\"highlight\">300 million</span> is selected.",
            pause: "Pause here (scroll or click)",
            finalIntro: "When you combine all the conditions so far,<br />",
            finalProbTemplate:
              "About 1 in {ratio}<br /><span style=\"font-size: 16px;\">({percent}%)</span>",
            finalProbNoSpermTemplate:
              "Excluding sperm probability: about 1 in {ratio} ({percent}%)",
            finalPending: "Calculating...",
          },
        },
      };

      const defaultLang = "ko";
      const supportedLangs = ["ko", "en"];
      let currentLang = defaultLang;

      function getTranslationValue(path, lang = currentLang) {
        return path
          .split(".")
          .reduce((obj, segment) => {
            if (!obj || typeof obj !== "object") return undefined;
            return Object.prototype.hasOwnProperty.call(obj, segment)
              ? obj[segment]
              : undefined;
          }, translations[lang]);
      }

      function t(key, vars = {}) {
        if (!key) return "";
        const value = getTranslationValue(key);
        if (typeof value !== "string") {
          return value ?? key;
        }
        return Object.entries(vars).reduce(
          (text, [varName, varValue]) =>
            text.replace(new RegExp(`\\{${varName}\\}`, "g"), varValue),
          value
        );
      }

      function detectLang() {
        const params = new URLSearchParams(window.location.search);
        const paramLang = params.get("lang");
        if (supportedLangs.includes(paramLang)) {
          return paramLang;
        }
        const stored = window.localStorage?.getItem("preferredLang");
        if (supportedLangs.includes(stored)) {
          return stored;
        }
        const intlLocale =
          typeof Intl === "object" && typeof Intl.DateTimeFormat === "function"
            ? Intl.DateTimeFormat().resolvedOptions().locale
            : "";
        const sources = [
          ...(navigator.languages || []),
          navigator.language,
          navigator.userLanguage,
          intlLocale,
        ]
          .filter(Boolean)
          .map((locale) => locale.toLowerCase());
        const hasKorean = sources.some((locale) => locale.startsWith("ko"));
        return hasKorean ? "ko" : "en";
      }

      function applyTranslations() {
        document.title = t("survey.metaTitle");
        const descMeta = document.querySelector('meta[name="description"]');
        if (descMeta) {
          descMeta.setAttribute("content", t("survey.metaDescription"));
        }
        document.documentElement.lang = currentLang;
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.dataset.i18n;
          if (!key) return;
          el.textContent = t(key);
        });
        document.querySelectorAll("[data-i18n-html]").forEach((el) => {
          const key = el.dataset.i18nHtml;
          if (!key) return;
          el.innerHTML = t(key);
        });
        document.querySelectorAll(".lang-switch button").forEach((button) => {
          button.classList.toggle(
            "active",
            button.dataset.lang === currentLang
          );
        });
        refreshDynamicTexts();
      }

      function setLang(lang, options = {}) {
        const nextLang = supportedLangs.includes(lang) ? lang : defaultLang;
        currentLang = nextLang;
        window.currentLang = currentLang;
        document.documentElement.lang = nextLang;
        try {
          window.localStorage?.setItem("preferredLang", nextLang);
        } catch (e) {
          // ignore
        }
        if (options.updateUrl) {
          const url = new URL(window.location.href);
          url.searchParams.set("lang", nextLang);
          window.history.replaceState({}, "", url);
        }
        applyTranslations();
      }

      const $ = (id) => document.getElementById(id);
      let currentStep = 1;
      let surveyData = {
        region: null,
        conditions: [],
        exclusions: [],
        regionRemaining: 1,
        finalProbability: null,
      };
      let step2Confirmed = false;

      function refreshDynamicTexts() {
        if (surveyData.region === "kr" && $("result1").style.display === "block") {
          $("result1Reason").innerHTML = t("result1.reason");
        }
        updateStep2ButtonLabel();
        updateRegionMessageDisplay(surveyData.regionRemaining ?? 1);
        if (currentStep === 4) {
          showStep4();
        }
        renderFinalProbability();
      }

      function updateStep2ButtonLabel() {
        const key = step2Confirmed ? "btn.step2.next" : "btn.step2.confirm";
        $("btn2").textContent = t(key);
      }

      function getRegionMessage(remaining) {
        if (remaining <= 0.1) {
          return t("result3.msg.low1");
        }
        if (remaining <= 0.2) {
          return t("result3.msg.low2");
        }
        if (remaining < 0.4) {
          return t("result3.msg.low3");
        }
        return t("result3.msg.default");
      }

      function updateRegionMessageDisplay(remaining = surveyData.regionRemaining ?? 1) {
        $("regionMsg").textContent = getRegionMessage(remaining);
      }

      function renderFinalProbability() {
        const data = surveyData.finalProbability;
        if (!data) return;
        $("finalProb").innerHTML = t("step5.finalProbTemplate", {
          ratio: data.ratio,
          percent: data.percent,
        });
        $("finalProbNoSperm").innerHTML = t(
          "step5.finalProbNoSpermTemplate",
          {
            ratio: data.ratioNoSperm,
            percent: data.percentNoSperm,
          }
        );
      }

      // STEP 1: ì§€ì—­ ì„ íƒ
      function selectOption(element, type, value) {
        const options = element.parentElement.querySelectorAll(".option");
        options.forEach((opt) => opt.classList.remove("selected"));
        element.classList.add("selected");

        surveyData[type] = value;

        const resultBox = $("result1");
        const probElement = $("prob1");
        const reasonElement = $("result1Reason");

        if (value === "kr") {
          probElement.textContent = "0.6%";
          reasonElement.innerHTML = t("result1.reason");
          resultBox.style.display = "block";
        } else {
          resultBox.style.display = "none";
        }

        $("btn1").disabled = false;
        updateProgress(1);
      }

      // STEP 2: ì²´í¬ë°•ìŠ¤ ì—…ë°ì´íŠ¸
      function updateCheckboxes() {
        const checks = [
          $("check1").checked,
          $("check2").checked,
          $("check3").checked,
          $("check4").checked,
        ];

        const checkedCount = checks.filter((c) => c).length;
        surveyData.conditions = checks;

        if (checkedCount >= 1) {
          $("btn2").disabled = false;
          updateProgress(2);
          if (step2Confirmed) {
            updateStep2Result(checkedCount);
          }
        } else {
          $("result2").style.display = "none";
          $("btn2").disabled = true;
          step2Confirmed = false;
          updateStep2ButtonLabel();
        }
      }

      function confirmStep2() {
        const checkedCount = surveyData.conditions.filter((c) => c).length;
        if (!step2Confirmed) {
          if (checkedCount < 1) {
            return;
          }
          updateStep2Result(checkedCount);
          $("result2").style.display = "block";
          step2Confirmed = true;
          updateStep2ButtonLabel();
          return;
        }
        nextStep(3);
      }

      function updateStep2Result(count) {
        const percentMap = {
          1: "45%",
          2: "30%",
          3: "17%",
          4: "8~9%",
        };
        $("prob2").textContent = percentMap[count] || "â€”";
      }

      function updateExclusions() {
        const rates = {
          exChina: 0.18,
          exIndia: 0.18,
          exAfrica: 0.18,
          exConflict: 0.12,
          exLowEdu: 0.2,
          exLowHealth: 0.22,
          exUnsafe: 0.18,
          exExtremePoverty: 0.25,
          exWater: 0.15,
          exCorruption: 0.15,
        };
        const keys = Object.keys(rates);
        const selectedKeys = keys.filter((key) => $(key).checked);
        surveyData.exclusions = selectedKeys;

        let remaining = 1;
        selectedKeys.forEach((key) => {
          remaining *= 1 - rates[key];
        });

        const remainingPercent = Math.round(remaining * 1000) / 10;
        $("regionProb").textContent = `${remainingPercent.toFixed(1)}%`;
        surveyData.regionRemaining = remaining;

        updateRegionMessageDisplay(remaining);
        $("result3").style.display = "block";
        updateProgress(3);
      }

      // STEP 4: ìš”ì•½ ì—…ë°ì´íŠ¸
      function showStep4() {
        const regionText =
          surveyData.region === "kr"
            ? t("step4.summary.region.kr")
            : t("step4.summary.region.other");
        $("summaryRegion").textContent = regionText;

        const conditionCount = surveyData.conditions.filter((c) => c).length;
        const conditionKey =
          conditionCount >= 3
            ? "step4.summary.condition.high"
            : "step4.summary.condition.low";
        $("summaryCondition").textContent = t(conditionKey);

        const selected = surveyData.exclusions || [];
        const exclusionText =
          selected.length > 0
            ? `${t("step4.summary.exclusion.prefix")}${selected
                .map((key) => t(`exclusions.${key}`) || key)
                .join(", ")}`
            : t("step4.summary.exclusion.none");
        $("summaryExclusions").textContent = exclusionText;

        const remaining = surveyData.regionRemaining ?? 1;
        const excludedPercent = ((1 - remaining) * 100).toFixed(1);
        $("summaryRemaining").textContent = t(
          "step4.summary.remaining",
          {
            percent: excludedPercent,
          }
        );

        updateProgress(4);
      }

      // STEP 5: ìµœì¢… í™•ë¥  ê³„ì‚°
      function calculateFinal() {
        let baseProb = surveyData.region === "kr" ? 0.006 : 0.015;
        const conditionCount = surveyData.conditions.filter((c) => c).length;
        const conditionProbMap = {
          1: 0.45,
          2: 0.3,
          3: 0.17,
          4: 0.085,
        };
        let conditionProb = conditionProbMap[conditionCount] || 1;
        let regionProb = surveyData.regionRemaining || 1;
        let spermProb = 1 / 300000000;

        let cumulative = baseProb * conditionProb * regionProb * spermProb;
        let cumulativeNoSperm = baseProb * conditionProb * regionProb;

        const finalPercent = (cumulative * 100).toFixed(10);
        const finalRatio = Math.round(1 / cumulative).toLocaleString();
        const finalPercentNoSperm = (cumulativeNoSperm * 100).toFixed(4);
        const finalRatioNoSperm = Math.round(1 / cumulativeNoSperm).toLocaleString();

        surveyData.finalProbability = {
          ratio: finalRatio,
          percent: finalPercent,
          ratioNoSperm: finalRatioNoSperm,
          percentNoSperm: finalPercentNoSperm,
        };

        renderFinalProbability();
        updateProgress(5);
      }

      function nextStep(step) {
        $(`step${currentStep}`).classList.remove("active");
        currentStep = step;
        $(`step${step}`).classList.add("active");

        if (step === 3) {
          setTimeout(updateExclusions, 0);
        } else if (step === 4) {
          showStep4();
        } else if (step === 5) {
          setTimeout(calculateFinal, 500);
        }

        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function updateProgress(step) {
        const progress = (step / 5) * 100;
        $("progressFill").style.width = progress + "%";
      }

      function goToResult() {
        const params = new URLSearchParams({
          region: surveyData.region || "kr",
          conditions: surveyData.conditions
            .map((c) => (c ? "1" : "0"))
            .join(""),
          exclusions: (surveyData.exclusions || []).join(","),
          remaining: (surveyData.regionRemaining ?? 1).toFixed(4),
          final: surveyData.finalProbability?.ratio || "0",
        });
        window.location.href = `result.html?${params.toString()}`;
      }

      document.querySelectorAll(".lang-switch button").forEach((button) => {
        button.addEventListener("click", () => {
          setLang(button.dataset.lang, { updateUrl: true });
        });
      });

      setLang(detectLang(), { updateUrl: false });
      updateProgress(1);
    </script>
  </body>
</html>
